networks:
    datn-network:
        driver: bridge

volumes:
    frontend_node_modules:
    backend_venv:

services:
    # docker-compose -f docker-compose.dev.yml up --build frontend
    frontend:
        build:
            context: .
            dockerfile: ./dockerfiles/frontend.dev.dockerfile
        container_name: datn-frontend
        ports:
            - "5173:5173"
        volumes:
            - ./frontend:/app:delegated
            - frontend_node_modules:/app/node_modules
        environment:
            - NODE_ENV=development
        command: sh -c "bun install && bun dev -- --host 0.0.0.0"
        stdin_open: true
        tty: true
        networks:
            - datn-network

    # docker-compose -f docker-compose.dev.yml up --build backend
    backend:
        build:
            context: .
            dockerfile: ./dockerfiles/backend.dev.dockerfile
        container_name: datn-backend
        working_dir: /app
        ports:
            - "5000:5000"
        volumes:
            - ./backend:/app:delegated
            - backend_venv:/app/.venv
        env_file:
            - ./backend/.env
        command: sh -c ".venv/bin/flask run --host 0.0.0.0"
        tty: true
        stdin_open: true
        restart: unless-stopped
        deploy:
            resources:
                limits:
                    cpus: "1"
                    memory: 1G
        networks:
            - datn-network
